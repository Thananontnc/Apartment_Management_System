'use client';

import React, { createContext, useContext, useState, useEffect } from 'react';

type Language = 'en' | 'th';

interface I18nContextType {
    lang: Language;
    setLang: (lang: Language) => void;
    t: (key: string, params?: Record<string, string>) => string;
}

const translations = {
    en: {
        dashboard: 'Dashboard',
        properties: 'Properties',
        utility_manager: 'Utility Manager',
        billing_payments: 'Billing & Payments',
        add_property: 'Add Property',
        record_meters: 'Record Meters',
        save_readings: 'Save Readings & Generate Invoices',
        occupancy_rate: 'Occupancy Rate',
        projected_revenue: 'Projected Revenue',
        rooms: 'Rooms',
        status: 'Status',
        action: 'Action',
        back_to_dashboard: 'Back to Dashboard',
        back_to_properties: 'Back to Properties',
        back_to_selection: 'Back to Selection',
        back_to_assets: 'Back to Assets',
        login: 'Login',
        logout: 'Logout',
        email: 'Email',
        password: 'Password',
        welcome: 'Welcome back. Here is your business at a glance.',
        quick_actions: 'Quick Actions',
        property_overview: 'Property Overview',
        record_meters_desc: 'Record meters and generate invoices.',
        manage_rooms_desc: 'Manage rooms and buildings.',
        mark_paid_desc: 'Manage payments.',
        edit_property_info: 'Edit Property Info',
        add_room: 'Add Room',
        bulk_add_rooms: 'Bulk Add Rooms',
        room_number: 'Room #',
        floor: 'Floor',
        rent: 'Rent',
        elec_rate: 'Elec Rate',
        water_rate: 'Water Rate',
        def_rent: 'Def. Rent',
        save_changes: 'Save Changes',
        vacant: 'Vacant',
        occupied: 'Occupied',
        maintenance: 'Maintenance',
        paid: 'PAID',
        unpaid: 'UNPAID',
        cash: 'Cash',
        qr_code: 'QR Code',
        completed: 'Completed',
        total: 'Total',
        elec: 'Elec',
        water: 'Water',
        finance: 'Finance',

        // Meter Hub
        meter_hub: 'Meter Hub',
        revision_mode: 'Revision Mode',
        precision_monitoring: 'Precision utility monitoring & monthly statement generation.',
        operational_audit: 'Operational Audit',
        complete: 'Complete',
        cards: 'Cards',
        table: 'Table',
        institutional_revenue: 'Institutional Revenue Flow',
        estimated_target: 'Estimated Target for',
        unit_rent: 'UNIT RENT',
        energy: 'ENERGY',
        cycle: 'Cycle',
        finalize_batch: 'Finalize Batch Records',
        authorize_generate: 'Authorize & Generate Ledger',
        energy_kwh: 'Energy (kWh)',
        water_units: 'Water (Units)',
        current_reading: 'Current Reading',
        prev: 'Prev',
        curr: 'Curr',
        total_ledger: 'Total Ledger',

        // Apartments
        real_estate_portfolio: 'Real Estate Portfolio',
        monitor_manage: 'Monitor and manage your property assets and operational rates.',
        portfolio_empty: 'Portfolio Empty',
        units_registered: 'Units Registered',
        active: 'Active',
        ledger: 'Ledger',
        config: 'Config',
        remove: 'Remove',
        expand_portfolio: 'Expand Portfolio',
        onboard_property: 'Onboard a new property and define its standard operating parameters.',
        property_designation: 'Property Designation',
        geographic_location: 'Geographic Location',
        base_monthly_rent: 'Base Monthly Rent (฿)',
        unit_capacity: 'Unit Capacity',
        init_property: 'Initialize Property Assets',

        // Config
        configuration: 'Configuration',
        audit_ledger: 'Audit Historical Ledger',
        property_metadata: 'Property Metadata',
        building_designation: 'Building Designation',
        physical_address: 'Physical Address',
        register_new_unit: 'Register New Unit',
        unit_hash: 'Unit #',
        allocated_rent: 'Allocated Rent',
        finalize_asset: 'Finalize Asset',
        batch_propagation: 'Batch Propagation',
        asset_inventory: 'Asset Inventory',
        operational_status: 'Operational Status',
        current_rent: 'Current Rent',
        archival: 'Archival',
        no_units_found: 'No units found in this property asset inventory.',

        // Messages
        confirm_delete_apartment: 'Are you sure you want to decommission {name}? All historical data will be archived.',
        confirm_delete_room: 'Permanently remove Unit {number}?',

        // Utilities Selection
        meter_hubs: 'Meter Hubs & Readings',
        select_asset: 'Select an asset to record monthly utility consumption.',
        no_active_portfolios: 'No Active Portfolios',
        init_building: 'Initialize your building assets in the Management section to begin recording.',

        // Dashboard Extras
        finance_desc: 'Analyze profit, mortgage, and operational costs.',
        property_mgmt_desc: 'Manage building data and room sets.',
        view_all_properties: 'View All Properties',
        no_properties_found: 'No properties found yet.',
        no_rooms_added: 'No rooms added yet.',
        history: 'History',
        manage: 'Manage',
        net_cash_flow: 'Net Cash flow',
        target_for: 'Target for',
        pending: 'Pending',
        fully_collected: 'Fully Collected',
        print_invoices: 'Print Batch Invoices',

        // Invoices
        generated_invoices: 'Generated Invoices',
        asset_portfolio: 'Asset Portfolio',
        latest_records: 'Latest Records',
        print_ledger: 'Print Ledger',
        unit_designation: 'UNIT DESIGNATION',
        statement_date: 'STATEMENT DATE',
        qty: 'QTY',
        item_description: 'ITEM DESCRIPTION',
        rate: 'RATE',
        subtotal: 'SUBTOTAL',
        water_usage_bill: 'Water Usage',
        elec_usage_bill: 'Electricity Usage',
        base_rent_bill: 'Monthly Base Rent',
        metrics_audit: 'METRICS AUDIT',
        present: 'PRESENT',
        previous: 'PREVIOUS',
        water_meter: 'Water Meter',
        energy_meter: 'Energy Meter',
        grand_total_due: 'GRAND TOTAL DUE',
        bath_unit: '฿',

        // Billing Action
        confirm_payment: 'Confirm Payment',
        confirm_payment_desc: 'Please verify the amount and payment method before confirming.',
        cancel: 'Cancel',
        confirm: 'Confirm',
        undo_payment: 'Undo Payment',
        confirm_undo_payment: 'Are you sure you want to mark this as UNPAID?',

        // Login
        app_name: 'Property Manager',
        login_subtitle: 'Please login to continue',
        email_label: 'Email Address',
        password_label: 'Password',
        login_btn: 'Login',
        logging_in: 'Logging in...',
        invalid_credentials: 'Invalid email or password',
        default_password_hint: 'Default Password is',

        // Finance
        finance_analytics: 'Finance Analytics',
        finance_subtitle: 'Deep dive into your property\'s financial performance and trends.',
        summary: 'Summary',
        revenue_breakdown: 'Revenue Breakdown',
        utility_trends: 'Utility Trends',
        occupancy_flow: 'Occupancy Flow',
        maintenance_hub: 'Maintenance Hub',
        current_month_rev: 'Current Month Revenue',
        invoiced_projected: 'Invoiced & Projected',
        monthly_outflow: 'Monthly Outflow',
        mortgage_ops_fix: 'Mortgage, Ops & Fix',
        est_net_profit: 'Estimated Net Profit',
        margin: 'Margin',
        financial_trajectory: 'Property Financial Trajectory',
        evolution_desc: 'Revenue vs Expenses vs Profit Evolution',
        real_time_data: 'Real-time Data',
        revenue_segmentation: 'Revenue Source Segmentation',
        hist_breakdown_desc: 'Historical breakdown of rent and utilities',
        room_rent: 'Room Rent',
        hist_ledgers: 'Historical Ledgers',
        growth: 'Growth',
        meter_analysis: 'Meter Consumption Analysis',
        resource_patterns: 'Resource usage patterns over time',
        elec_usage_units: 'Electricity Usage (Units)',
        water_usage_units: 'Water Usage (Units)',
        avg_elec_cons: 'Avg. Electricity Consumption',
        avg_water_cons: 'Avg. Water Consumption',
        tenant_flow_dynamics: 'Tenant Flow Dynamics',
        lifecycle_desc: 'Lifecycle of room occupancy and transitions',
        move_ins: 'Move Ins',
        move_outs: 'Move Outs',
        to_maintenance: 'To Maintenance',
        recent_status_conversions: 'Recent Status Conversions',
        timestamp: 'Timestamp',
        room: 'Room',
        transition: 'Transition',
        maintenance_dispatch: 'Maintenance Dispatch',
        target_asset: 'Target Asset',
        general_property: 'General Property',
        work_type: 'Work Type',
        repair: 'Repair',
        cleaning: 'Cleaning',
        upgrade: 'Upgrade',
        other: 'Other',
        cost_allocation: 'Cost Allocation',
        dispatch_order: 'Dispatch Order',
        brief_specs: 'Brief Specifications',
        maintenance_required_placeholder: 'Explain the maintenance required...',
        opex_entry: 'OpEx Entry',
        net_amount: 'Net Amount',
        ledger_head: 'Ledger Head',
        staff_salary: 'Staff Salary',
        taxes: 'Taxes',
        other_costs: 'Other Costs',
        accounting_period: 'Accounting Period',
        commit_entry: 'Commit Entry',
        maintenance_repair_logs: 'Maintenance & Repair Logs',
        date: 'Date',
        target: 'Target',
        description: 'Description',
        capital_liabilities: 'Capital Liabilities (Mortgage)',
        mortgage_manage_desc: 'Manage your base financial obligations for {name}',
        monthly_repayment: 'Monthly Repayment',
        update_financial_settings: 'Update Financial Settings'
    },
    th: {
        dashboard: 'แดชบอร์ด',
        properties: 'ทรัพย์สิน',
        utility_manager: 'จัดการค่าน้ำค่าไฟ',
        billing_payments: 'การเรียกเก็บเงินและการชำระเงิน',
        add_property: 'เพิ่มสถานที่',
        record_meters: 'จดมิเตอร์',
        save_readings: 'บันทึกมิเตอร์และสร้างใบแจ้งหนี้',
        occupancy_rate: 'อัตราการเข้าพัก',
        projected_revenue: 'รายได้โดยประมาณ',
        rooms: 'ห้อง',
        status: 'สถานะ',
        action: 'ดำเนินการ',
        back_to_dashboard: 'กลับหน้าหลัก',
        back_to_properties: 'กลับหน้าทรัพย์สิน',
        back_to_selection: 'กลับหน้าเลือก',
        back_to_assets: 'กลับหน้าสินทรัพย์',
        login: 'เข้าสู่ระบบ',
        logout: 'ออกจากระบบ',
        email: 'อีเมล',
        password: 'รหัสผ่าน',
        welcome: 'ยินดีต้อนรับกลับมา',
        quick_actions: 'ทางลัด',
        property_overview: 'ภาพรวมทรัพย์สิน',
        record_meters_desc: 'จดมิเตอร์และสร้างใบแจ้งหนี้',
        manage_rooms_desc: 'จัดการห้องและอาคาร',
        mark_paid_desc: 'จัดการการชำระเงิน',
        edit_property_info: 'แก้ไขข้อมูล',
        add_room: 'เพิ่มห้อง',
        bulk_add_rooms: 'เพิ่มห้องจำนวนมาก',
        room_number: 'เลขห้อง',
        floor: 'ชั้น',
        rent: 'ค่าเช่า',
        elec_rate: 'ค่าไฟ',
        water_rate: 'ค่าน้ำ',
        def_rent: 'ค่าเช่า',
        save_changes: 'บันทึก',
        vacant: 'ว่าง',
        occupied: 'มีคนอยู่',
        maintenance: 'ปรับปรุง',
        paid: 'จ่ายแล้ว',
        unpaid: 'ค้างชำระ',
        cash: 'เงินสด',
        qr_code: 'QR Code',
        completed: 'เสร็จสิ้น',
        total: 'รวม',
        elec: 'ไฟ',
        water: 'น้ำ',
        finance: 'การเงิน',

        // Meter Hub
        meter_hub: 'ศูนย์กลางมิเตอร์',
        revision_mode: 'โหมดแก้ไข',
        precision_monitoring: 'การตรวจสอบมิเตอร์และสร้างใบแจ้งหนี้ประจำเดือน',
        operational_audit: 'ตรวจสอบยอด',
        complete: 'เสร็จสิ้น',
        cards: 'การ์ด',
        table: 'ตาราง',
        institutional_revenue: 'กระแสรายรับของอาคาร',
        estimated_target: 'เป้าหมายโดยประมาณสำหรับ',
        unit_rent: 'ค่าเช่าห้อง',
        energy: 'พลังงาน',
        cycle: 'รอบบิล',
        finalize_batch: 'ยืนยันข้อมูลชุด',
        authorize_generate: 'อนุมัติและสร้างบัญชี',
        energy_kwh: 'ไฟฟ้า (หน่วย)',
        water_units: 'น้ำ (หน่วย)',
        current_reading: 'เลขปัจจุบัน',
        prev: 'ก่อน',
        curr: 'หลัง',
        total_ledger: 'ยอดรวม',

        // Apartments
        real_estate_portfolio: 'พอร์ตโฟลิโออสังหาริมทรัพย์',
        monitor_manage: 'ตรวจสอบและจัดการทรัพย์สินและอัตราค่าดำเนินงานของคุณ',
        portfolio_empty: 'ไม่มีข้อมูลพอร์ตโฟลิโอ',
        units_registered: 'ห้อง',
        active: 'ใช้งานอยู่',
        ledger: 'บัญชี',
        config: 'ตั้งค่า',
        remove: 'ลบ',
        expand_portfolio: 'ขยายพอร์ตโฟลิโอ',
        onboard_property: 'เพิ่มทรัพย์สินใหม่และกำหนดค่ามาตรฐาน',
        property_designation: 'ชื่อทรัพย์สิน',
        geographic_location: 'ที่ตั้ง / ที่อยู่',
        base_monthly_rent: 'ค่าเช่ารายเดือนฐาน (฿)',
        unit_capacity: 'จำนวนห้อง',
        init_property: 'เริ่มต้นทรัพย์สิน',

        // Config
        configuration: 'การตั้งค่า',
        audit_ledger: 'ตรวจสอบบัญชีย้อนหลัง',
        property_metadata: 'ข้อมูลจำเพาะทรัพย์สิน',
        building_designation: 'ชื่ออาคาร',
        physical_address: 'ที่อยู่ทางกายภาพ',
        register_new_unit: 'ลงทะเบียนห้องใหม่',
        unit_hash: 'เลขที่ห้อง',
        allocated_rent: 'ค่าเช่าที่กำหนด',
        finalize_asset: 'ยืนยันสินทรัพย์',
        batch_propagation: 'การสร้างแบบชุด',
        asset_inventory: 'คลังสินทรัพย์',
        operational_status: 'สถานะการดำเนินงาน',
        current_rent: 'ค่าเช่าปัจจุบัน',
        archival: 'การจัดเก็บ',
        no_units_found: 'ไม่พบห้องในคลังสินทรัพย์นี้',

        // Messages
        confirm_delete_apartment: 'คุณแน่ใจหรือไม่ที่จะปิดตัว {name}? ข้อมูลประวัติทั้งหมดจะถูกเก็บถาวร',
        confirm_delete_room: 'ลบห้อง {number} ถาวรใช่หรือไม่?',

        // Utilities Selection
        meter_hubs: 'ศูนย์กลางมิเตอร์และการอ่านค่า',
        select_asset: 'เลือกสินทรัพย์เพื่อบันทึกการใช้สาธารณูปโภคประจำเดือน',
        no_active_portfolios: 'ไม่มีพอร์ตโฟลิโอที่ใช้งานอยู่',
        init_building: 'เริ่มต้นทรัพย์สินอาคารของคุณในส่วนการจัดการเพื่อเริ่มบันทึก',

        // Dashboard Extras
        finance_desc: 'วิเคราะห์กำไร สินเชื่อบ้าน และค่าใช้จ่ายการดำเนินงาน',
        property_mgmt_desc: 'จัดการข้อมูลอาคารและชุดห้องพัก',
        view_all_properties: 'ดูทรัพย์สินทั้งหมด',
        no_properties_found: 'ยังไม่พบทรัพย์สิน',
        no_rooms_added: 'ยังไม่มีห้องพัก',
        history: 'ประวัติ',
        manage: 'จัดการ',
        net_cash_flow: 'กระแสเงินสดสุทธิ',
        target_for: 'เป้าหมายสำหรับ',
        pending: 'ค้างชำระ',
        fully_collected: 'เก็บครบแล้ว',
        print_invoices: 'พิมพ์ใบแจ้งหนี้',

        // Invoices
        generated_invoices: 'ใบแจ้งหนี้ที่สร้างขึ้น',
        asset_portfolio: 'พอร์ตโฟลิโอสินทรัพย์',
        latest_records: 'บันทึกล่าสุด',
        print_ledger: 'พิมพ์บัญชีแยกประเภท',
        unit_designation: 'หมายเลขห้อง',
        statement_date: 'วันที่ออกใบแจ้งหนี้',
        qty: 'จำนวน',
        item_description: 'รายการ',
        rate: 'ราคาต่อหน่วย',
        subtotal: 'ราคารวม',
        water_usage_bill: 'ค่าน้ำประปา',
        elec_usage_bill: 'ค่าไฟฟ้า',
        base_rent_bill: 'ค่าเช่าห้องพัก',
        metrics_audit: 'ตรวจสอบมิเตอร์',
        present: 'ครั้งนี้',
        previous: 'ครั้งก่อน',
        water_meter: 'มิเตอร์น้ำ',
        energy_meter: 'มิเตอร์ไฟ',
        grand_total_due: 'ยอดรวมทั้งสิ้น',
        bath_unit: 'บาท',

        // Billing Action
        confirm_payment: 'ยืนยันการชำระเงิน',
        confirm_payment_desc: 'กรุณาตรวจสอบจำนวนเงินและวิธีการชำระเงินก่อนกดยืนยัน',
        cancel: 'ยกเลิก',
        confirm: 'ยืนยัน',
        undo_payment: 'ยกเลิกสถานะจ่ายแล้ว',
        confirm_undo_payment: 'คุณแน่ใจหรือไม่ที่จะเปลี่ยนสถานะเป็นยังไม่จ่าย?',

        // Login
        app_name: 'ระบบจัดการหอพัก',
        login_subtitle: 'กรุณาเข้าสู่ระบบเพื่อดำเนินการต่อ',
        email_label: 'อีเมล',
        password_label: 'รหัสผ่าน',
        login_btn: 'เข้าสู่ระบบ',
        logging_in: 'กำลังเข้าสู่ระบบ...',
        invalid_credentials: 'อีเมลหรือรหัสผ่านไม่ถูกต้อง',
        default_password_hint: 'รหัสผ่านเริ่มต้นคือ',

        // Finance
        finance_analytics: 'การวิเคราะห์การเงิน',
        finance_subtitle: 'เจาะลึกผลประกอบการทางการเงินและแนวโน้มของทรัพย์สินของคุณ',
        summary: 'สรุป',
        revenue_breakdown: 'แยกรายละเอียดรายได้',
        utility_trends: 'แนวโน้มสาธารณูปโภค',
        occupancy_flow: 'กระแสการเข้าพัก',
        maintenance_hub: 'ศูนย์ซ่อมบำรุง',
        current_month_rev: 'รายได้เดือนปัจจุบัน',
        invoiced_projected: 'ออกใบแจ้งหนี้และประมาณการ',
        monthly_outflow: 'รายจ่ายรายเดือน',
        mortgage_ops_fix: 'ค่างวด, ค่าดำเนินงาน และค่าซ่อม',
        est_net_profit: 'กำไรสุทธิโดยประมาณ',
        margin: 'อัตรากำไร',
        financial_trajectory: 'แนวโน้มทางการเงินของทรัพย์สิน',
        evolution_desc: 'วิวัฒนาการรายได้เทียบรายจ่ายและกำไร',
        real_time_data: 'ข้อมูลตามจริง',
        revenue_segmentation: 'การจัดกลุ่มแหล่งรายได้',
        hist_breakdown_desc: 'รายละเอียดค่าเช่าและสาธารณูปโภคย้อนหลัง',
        room_rent: 'ค่าเช่าห้องพัก',
        hist_ledgers: 'บัญชีแยกประเภทย้อนหลัง',
        growth: 'การเติบโต',
        meter_analysis: 'การวิเคราะห์การใช้มิเตอร์',
        resource_patterns: 'รูปแบบการใช้ทรัพยากรตามช่วงเวลา',
        elec_usage_units: 'การใช้ไฟฟ้า (หน่วย)',
        water_usage_units: 'การใช้น้ำ (หน่วย)',
        avg_elec_cons: 'ค่าเฉลี่ยการใช้ไฟฟ้า',
        avg_water_cons: 'ค่าเฉลี่ยการใช้น้ำ',
        tenant_flow_dynamics: 'พลวัตการไหลเวียนของผู้เช่า',
        lifecycle_desc: 'วงจรชีวิตของการเข้าพักและการเปลี่ยนแปลง',
        move_ins: 'ย้ายเข้า',
        move_outs: 'ย้ายออก',
        to_maintenance: 'ส่งซ่อม',
        recent_status_conversions: 'การเปลี่ยนสถานะล่าสุด',
        timestamp: 'วันเวลา',
        room: 'ห้อง',
        transition: 'การเปลี่ยนแปลง',
        maintenance_dispatch: 'ส่งงานซ่อมบำรุง',
        target_asset: 'เป้าหมายที่ซ่อม',
        general_property: 'พื้นที่ส่วนกลาง',
        work_type: 'ประเภทงาน',
        repair: 'ซ่อมแซม',
        cleaning: 'ทำความสะอาด',
        upgrade: 'ปรับปรุง',
        other: 'อื่นๆ',
        cost_allocation: 'การจัดสรรงบประมาณ (฿)',
        dispatch_order: 'ส่งคำสั่งงาน',
        brief_specs: 'รายละเอียดงานย่อ',
        maintenance_required_placeholder: 'อธิบายรายละเอียดงานซ่อมที่ต้องการ...',
        opex_entry: 'บันทึกค่าใช้จ่ายการดำเนินงาน',
        net_amount: 'จำนวนเงินสุทธิ',
        ledger_head: 'ประเภทบัญชี',
        staff_salary: 'เงินเดือนพนักงาน',
        taxes: 'ภาษี',
        other_costs: 'ค่าใช้จ่ายอื่นๆ',
        accounting_period: 'งวดบัญชี',
        commit_entry: 'ยืนยันการบันทึก',
        maintenance_repair_logs: 'ประวัติการซ่อมบำรุง',
        date: 'วันที่',
        target: 'เป้าหมาย',
        description: 'รายละเอียด',
        capital_liabilities: 'ภาระหนี้สินทางการเงิน (จำนอง/ค่างวด)',
        mortgage_manage_desc: 'จัดการภาระทางการเงินหลักของคุณสำหรับ {name}',
        monthly_repayment: 'ค่างวดรายเดือน',
        update_financial_settings: 'อัปเดตการตั้งค่าทางการเงิน'
    }
};

const I18nContext = createContext<I18nContextType | undefined>(undefined);

export function I18nProvider({ children }: { children: React.ReactNode }) {
    const [lang, setLang] = useState<Language>('th');

    useEffect(() => {
        const saved = localStorage.getItem('lang') as Language;
        if (saved) setLang(saved);
    }, []);

    const toggleLang = (newLang: Language) => {
        setLang(newLang);
        localStorage.setItem('lang', newLang);
    };

    const t = (key: string, params?: Record<string, string>) => {
        let text = (translations[lang] as any)[key] || key;
        if (params) {
            Object.entries(params).forEach(([k, v]) => {
                text = text.replace(`{${k}}`, v);
            });
        }
        return text;
    };

    return (
        <I18nContext.Provider value={{ lang, setLang: toggleLang, t }}>
            {children}
        </I18nContext.Provider>
    );
}

export function useI18n() {
    const context = useContext(I18nContext);
    if (!context) throw new Error('useI18n must be used within I18nProvider');
    return context;
}
